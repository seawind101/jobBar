<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>All Jobs</title>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/allJobs.css">
    <script defer src="/js/job.js"></script>
    <script defer src="/js/searchJobs.js"></script>
</head>
<body>
    <main class="jobs-container">
        <div class="nav-row">
            <button class="small-btn" onclick="location.href='/companies'">All companies</button>
            <input id="job-search-input" type="text" placeholder="Search jobs..." style="margin-left:1rem;flex:1;min-width:180px;padding:0.4rem;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:#fff"/>

        </div>
        
        <h1 style="margin-top:1rem">All Open Jobs</h1>
        <div class="jobs-list" style="max-width:1100px;margin:1rem auto;padding:0 1rem;">
            <% if (jobs && jobs.length > 0) { %>
                <% jobs.forEach(function(job){ %>
                    <article class="job-card">
                        <div class="job-title">
                            <b><%= job.title %></b>
                            <span style="color:#f7d2df;font-weight:700;margin-left:8px">@
                                <a href="/job/<%= encodeURIComponent(job.company_name || job.company) %>" style="color:#f7d2df;text-decoration:underline">
                                    <%= job.company_name || job.company %>
                                </a>
                            </span>
                        </div>
                        <% if (job.company_description) { %>
                            <div class="company-desc" style="color:#ddd;margin:0.4rem 0;font-size:0.95rem"><%= job.company_description %></div>
                        <% } %>
                        <div class="job-desc"><%= job.description %></div>
                        <div class="job-pay">Pay: <%= job.pay %></div>
                        <div style="margin-top:0.6rem">
                            <% if (job.you_applied) { %>
                                <span class="job-meta taken">You applied</span>
                            <% } else { %>
                                <form action="/job/<%= job.id %>/apply" method="POST" style="display:inline">
                                    <button type="submit" class="apply-btn">Apply</button>
                                </form>
                            <% } %>
                        </div>
                    </article>
                <% }) %>
            <% } else { %>
                <p style="text-align:center">No jobs available.</p>
            <% } %>
        </div>
    </main>
        <script>
            document.addEventListener('DOMContentLoaded', function(){
                if (window.jobSearchInit) window.jobSearchInit('job-search-input');
            });
        </script>
</body>
</html>