<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apply for Job</title>
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="/css/post.css">
</head>
<body class="create-company-page">
  <nav class="top-controls">
    <button onclick="location.href='/'">Home</button>
    <button onclick="location.href='/companies'">Companies</button>
  </nav>

  <div class="container">
    <div class="post-card">
      <% const JOB = (typeof job !== 'undefined') ? job : null; const POS = (typeof position !== 'undefined') ? position : null; const COMP = (typeof company !== 'undefined') ? company : null; %>
      <h1>Apply for: <%= JOB ? JOB.title : (POS ? POS.title : 'Job') %></h1>
      <% if (COMP) { %>
        <h3>Company: <%= COMP.name %></h3>
      <% } %>

      <form id="eform" action="/eform" method="POST" enctype="multipart/form-data">
        <input type="hidden" name="jobId" value="<%= JOB ? JOB.id : '' %>">
        <input type="hidden" name="positionId" value="<%= POS ? POS.id : '' %>">

        <div class="form-row">
          <label for="first_name">First name</label>
          <input id="first_name" name="first_name" type="text" required>
        </div>

        <div class="form-row">
          <label for="last_name">Last name</label>
          <input id="last_name" name="last_name" type="text" required>
        </div>

        <div class="form-row">
          <label for="resume">Resume (PDF preferred)</label>
          <input id="resume" name="resume" type="file" accept="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
        </div>

        <div class="form-row">
          <label for="portfolio">Portfolio</label>
          <div style="display:flex;flex-direction:column;gap:6px">
            <div>
              <strong>Upload PNG images</strong>
              <input id="portfolio_files" name="portfolio" type="file" accept="image/png" multiple>
            </div>
            <div>
              <strong>Or provide links to your work (comma-separated)</strong>
              <input id="portfolio_links" name="portfolio_links" type="text" placeholder="https://example.com, https://behance.net/..." style="width:100%">
            </div>
          </div>
        </div>

        <div class="form-row">
          <label for="cover_letter">Cover Letter (PDF)</label>
          <input id="cover_letter" name="cover_letter" type="file" accept="application/pdf">
        </div>

        <div style="text-align:center;margin-top:0.6rem;">
          <button type="submit">Submit Application</button>
        </div>
      </form>
    </div>
  </div>
    <script>
      (function(){
        const form = document.getElementById('eform');
        const resumeInput = document.getElementById('resume');
        const coverInput = document.getElementById('cover_letter');
        const portfolioFiles = document.getElementById('portfolio_files');
        const portfolioLinks = document.getElementById('portfolio_links');

        function fileIsPdfOrPng(file) {
          if (!file) return false;
          const t = file.type || '';
          const n = file.name || '';
          return t === 'application/pdf' || t === 'image/png' || /\.pdf$/i.test(n) || /\.png$/i.test(n);
        }

        function portfolioFileIsPng(file) {
          if (!file) return false;
          const t = file.type || '';
          const n = file.name || '';
          return t === 'image/png' || /\.png$/i.test(n);
        }

        form.addEventListener('submit', function(e){
          // Validate resume
          if (resumeInput && resumeInput.files && resumeInput.files[0]) {
            if (!fileIsPdfOrPng(resumeInput.files[0])) {
              e.preventDefault();
              alert('Resume must be a PDF or PNG file.');
              return false;
            }
          }
          // Validate cover letter
          if (coverInput && coverInput.files && coverInput.files[0]) {
            if (!fileIsPdfOrPng(coverInput.files[0])) {
              e.preventDefault();
              alert('Cover letter must be a PDF or PNG file.');
              return false;
            }
          }

          // Validate portfolio: either links or PNG files
          const linksVal = portfolioLinks && portfolioLinks.value && portfolioLinks.value.trim();
          const hasFiles = portfolioFiles && portfolioFiles.files && portfolioFiles.files.length > 0;
          if (!linksVal && !hasFiles) {
            // portfolio optional
          } else if (hasFiles) {
            for (const f of portfolioFiles.files) {
              if (!portfolioFileIsPng(f)) {
                e.preventDefault();
                alert('Portfolio uploads must be PNG images only.');
                return false;
              }
            }
          } else if (linksVal) {
            const parts = linksVal.split(',').map(s => s.trim()).filter(Boolean);
            const bad = parts.find(p => !/^https?:\/\//i.test(p));
            if (bad) {
              e.preventDefault();
              alert('Portfolio links must be full URLs (start with http:// or https://).');
              return false;
            }
          }
        });
      })();
    </script>
</body>
</html>